
<html>
<head>
    <script src="js/phaser.min.js"></script>
    <style>
            body{ margin: 0; overflow: hidden }
    </style>
</head>
<body>
    <div id="game"></div>
    <script>
        var debug = true;
        var game = new Phaser.Game(screen.width, screen.height, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update : update });

        function preload() {

            //clearGameCache();
            game.load.atlasJSONHash('eye_scene', 'assets/eyescene.png', 'js/eyescene.json');

            //  The second parameter is the URL of the image (relative)
            game.load.image('eye', 'assets/eye.png');
            game.load.image('mouth', 'assets/mouth.png');

            game.stage.backgroundColor = "#FFFF00";

        }

        function clearGameCache () {
            if(!debug) return; 
            game.cache = new Phaser.Cache(game);
            game.load.reset();
            game.load.removeAll();
        }

        var eye_left, eye_right, mouth, eye_scene, cursors;

        function create() {

            //console.log(bot);

            //	Enable p2 physics
	        game.physics.startSystem(Phaser.Physics.P2JS);

            //  Make things a bit more bouncey
            game.physics.p2.defaultRestitution = 0.8;

           //  This sprite is using a texture atlas for all of its animation data
           //  This creates a simple sprite that is using our loaded image and
            //  displays it on-screen and assign it to a variable
            eye_left = create_eye('eye_r1_c1.png', -250, -180);
            eye_right = create_eye('eye_r1_c1.png', 150, -180);

            // Create mouth
            mouth = game.add.sprite(game.world.centerX - 280, game.world.centerY + 50, "mouth");
            // Anime the mouth
            tween_mouth_down(mouth);

            cursors = game.input.keyboard.createCursorKeys();
        }

        function create_eye(key, x, y){
            //var eye = game.add.sprite(game.world.centerX + x, game.world.centerY + y, key);

            var eye = game.add.sprite(game.world.centerX + x, game.world.centerY + y, "eye_scene", key);

            //eye = game.add.sprite(game.world.centerX, game.world.centerY, key);

            var halfWidthEye = eye.texture.width/2;
            var halfHeightEye = eye.texture.height/2;

            eye.position.x -= halfWidthEye;
            eye.position.y -= halfHeightEye;

            tween_eye_down(eye);

            return eye;
        }


        function tween_mouth_down(mouth){
            //console.log("Animando");
            var tween = game.add.tween(mouth).to( { y: mouth.y + 5 }, 1000, Phaser.Easing.In, true);
            tween.onComplete.addOnce(function(){
                tween_mouth_up(mouth);
            }, this);
        }

        function tween_mouth_up(mouth){
            //console.log("Finalizado");
            var tween = game.add.tween(mouth).to( { y: mouth.y - 5 }, 1000, Phaser.Easing.In, true);
            tween.onComplete.addOnce(function(){
                tween_mouth_down(mouth);
            }, this);
        }


        function tween_eye_down(eye){
            //console.log("Animando");
            var tween = game.add.tween(eye).to( { y: eye.y + 20 }, 1000, Phaser.Easing.In, true);
            tween.onComplete.addOnce(function(){
                tween_eye_up(eye);
            }, this);
        }

        function tween_eye_up(eye){
            //console.log("Finalizado");
            var tween = game.add.tween(eye).to( { y: eye.y - 20 }, 1000, Phaser.Easing.In, true);
            tween.onComplete.addOnce(function(){
                tween_eye_down(eye);
            }, this);
        }

        function updateFrame(obj, frame){
            obj.frameName = frame;
        }

        function update(){

            //eye.body.setZeroVelocity();

            if (cursors.left.isDown)
            {
                //  Volta para olho aberto
                updateFrame(eye_right, "eye_r1_c1.png");
            }
            else if (cursors.right.isDown)
            {
                //  Piscar um olho
                updateFrame(eye_right, "eye_r1_c2.png");
            }

            if (cursors.up.isDown)
            {
                // eye_right.body.moveUp(400);
                
            }
            else if (cursors.down.isDown)
            {
                //eye.body.moveDown(400);
            }
        }
    </script>
</body>
</html>